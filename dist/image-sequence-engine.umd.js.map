{"version":3,"file":"image-sequence-engine.umd.js","sources":["../src/ImageSequenceEngine.js"],"sourcesContent":["class ImageSequenceEngine {\n  constructor(options = {}) {\n    this.options = {\n      container: null,\n      imageUrls: [],\n      initialLoadComplete: false,\n      onError: (error) => console.error(error),\n      ...options\n    };\n\n    if (!this.options.container) {\n      throw new Error('Container element is required');\n    }\n\n    if (!Array.isArray(this.options.imageUrls) || this.options.imageUrls.length === 0) {\n      throw new Error('Image URLs array is required and must not be empty');\n    }\n\n    this.totalFrames = this.options.imageUrls.length;\n    this.images = new Map();\n    this.loadingPromises = new Map();\n    this.currentFrame = 0;\n    this.isScrollLocked = true;\n    this.progress = 0;\n\n    this.init();\n  }\n\n  init() {\n    this.canvas = document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n    this.options.container.appendChild(this.canvas);\n\n    this.setupCanvas();\n    this.startInitialLoading();\n  }\n\n  setupCanvas() {\n    const updateSize = () => {\n      const rect = this.options.container.getBoundingClientRect();\n      const dpr = window.devicePixelRatio || 1;\n\n      this.canvas.width = rect.width * dpr;\n      this.canvas.height = rect.height * dpr;\n      this.canvas.style.width = `${rect.width}px`;\n      this.canvas.style.height = `${rect.height}px`;\n\n      this.ctx.scale(dpr, dpr);\n    };\n\n    updateSize();\n    window.addEventListener('resize', updateSize);\n  }\n\n  async startInitialLoading() {\n    try {\n      // Carica sempre il primo frame\n      await this.loadImage(this.options.imageUrls[0]);\n\n      // Carica 1 frame ogni 8 (8, 16, 24, ...)\n      const initialFrames = [0].concat(\n        Array.from({ length: Math.floor(this.totalFrames / 8) },\n          (_, i) => (i + 1) * 8)\n      );\n\n      await this.loadFrames(initialFrames);\n\n      this.unlockScroll();\n      this.startSecondaryLoading();\n    } catch (error) {\n      this.options.onError(error);\n    }\n  }\n\n  loadImage(url) {\n    if (!url) {\n      return Promise.reject(new Error('Invalid image URL'));\n    }\n\n    if (this.loadingPromises.has(url)) {\n      return this.loadingPromises.get(url);\n    }\n\n    if (this.images.has(url)) {\n      return Promise.resolve(this.images.get(url));\n    }\n\n    const promise = new Promise((resolve, reject) => {\n      const img = new Image();\n\n      img.onload = () => {\n        this.images.set(url, img);\n        this.loadingPromises.delete(url);\n        this.emit('imageLoaded', {\n          url,\n          loaded: this.images.size,\n          total: this.totalFrames\n        });\n        resolve(img);\n      };\n\n      img.onerror = () => {\n        this.loadingPromises.delete(url);\n        const error = new Error(`Failed to load image: ${url}`);\n        this.options.onError(error);\n        reject(error);\n      };\n\n      img.src = url;\n    });\n\n    this.loadingPromises.set(url, promise);\n    return promise;\n  }\n\n  setupCanvas() {\n    const updateSize = () => {\n      const rect = this.options.container.getBoundingClientRect();\n      const dpr = window.devicePixelRatio || 1;\n\n      this.canvas.width = rect.width * dpr;\n      this.canvas.height = rect.height * dpr;\n      this.canvas.style.width = `${rect.width}px`;\n      this.canvas.style.height = `${rect.height}px`;\n\n      this.ctx.scale(dpr, dpr);\n    };\n\n    updateSize();\n    window.addEventListener('resize', updateSize);\n  }\n\n  async startSecondaryLoading() {\n    // Carica i frame intermedi (4, 12, 20, ...)\n    const secondaryFrames = Array.from(\n      { length: Math.floor(this.totalFrames / 4) },\n      (_, i) => (i + 1) * 4\n    ).filter(frame => !this.images.has(this.options.imageUrls[frame]));\n\n    // Avvia il caricamento dei frame secondari\n    this.loadFrames(secondaryFrames).then(() => {\n      // Dopo i frame secondari, carica tutti i rimanenti in sequenza\n      const remainingFrames = Array.from(\n        { length: this.totalFrames },\n        (_, i) => i\n      ).filter(frame => !this.images.has(this.options.imageUrls[frame]));\n\n      this.loadFrames(remainingFrames);\n    });\n  }\n\n  unlockScroll() {\n    this.isScrollLocked = false;\n    this.setupScrollListener();\n    this.emit('readyToScroll');\n  }\n\n  setupScrollListener() {\n    const calculateProgress = () => {\n      const rect = this.options.container.getBoundingClientRect();\n      const scrollHeight = this.options.container.scrollHeight - window.innerHeight;\n      const scrollDistance = window.scrollY - rect.top;\n\n      this.progress = Math.max(0, Math.min(1, scrollDistance / scrollHeight));\n      this.render();\n    };\n\n    const observer = new IntersectionObserver((entries) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          window.addEventListener('scroll', calculateProgress);\n        } else {\n          window.removeEventListener('scroll', calculateProgress);\n        }\n      });\n    });\n\n    observer.observe(this.options.container);\n  }\n\n  async loadFrames(frameIndices) {\n    const promises = frameIndices.map(index => {\n      const url = this.options.imageUrls[index];\n      return this.loadImage(url);\n    });\n\n    await Promise.all(promises);\n    this.emit('batchLoaded', {\n      loaded: this.images.size,\n      total: this.totalFrames\n    });\n  }\n\n  render() {\n    if (this.isScrollLocked) return;\n\n    const frameIndex = Math.floor(this.progress * (this.totalFrames - 1));\n    const imageUrl = this.options.imageUrls[frameIndex];\n    const image = this.images.get(imageUrl);\n\n    if (image && frameIndex !== this.currentFrame) {\n      this.currentFrame = frameIndex;\n      this.drawImage(image);\n    }\n  }\n\n  drawImage(image) {\n    const canvas = this.canvas;\n    const ctx = this.ctx;\n    const containerRect = this.options.container.getBoundingClientRect();\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const containerRatio = containerRect.width / containerRect.height;\n    const imageRatio = image.width / image.height;\n\n    let drawWidth = containerRect.width;\n    let drawHeight = containerRect.height;\n\n    if (containerRatio > imageRatio) {\n      drawHeight = drawWidth / imageRatio;\n    } else {\n      drawWidth = drawHeight * imageRatio;\n    }\n\n    const x = (containerRect.width - drawWidth) / 2;\n    const y = (containerRect.height - drawHeight) / 2;\n\n    ctx.drawImage(image, x, y, drawWidth, drawHeight);\n  }\n\n  emit(event, data) {\n    const eventName = `imageSequence:${event}`;\n    const customEvent = new CustomEvent(eventName, { detail: data });\n    this.options.container.dispatchEvent(customEvent);\n  }\n\n  getLoadingProgress() {\n    return {\n      loaded: this.images.size,\n      total: this.totalFrames,\n      percentage: (this.images.size / this.totalFrames) * 100\n    };\n  }\n\n  destroy() {\n    this.canvas.remove();\n    this.images.clear();\n    this.loadingPromises.clear();\n  }\n}\n\nexport default ImageSequenceEngine;\nexport { ImageSequenceEngine };"],"names":["ImageSequenceEngine","constructor","options","container","imageUrls","initialLoadComplete","onError","error","console","Error","Array","isArray","length","totalFrames","images","Map","loadingPromises","currentFrame","isScrollLocked","progress","init","canvas","document","createElement","ctx","getContext","appendChild","setupCanvas","startInitialLoading","updateSize","rect","getBoundingClientRect","dpr","window","devicePixelRatio","width","height","style","scale","addEventListener","loadImage","initialFrames","concat","from","Math","floor","_","i","loadFrames","unlockScroll","startSecondaryLoading","url","Promise","reject","has","get","resolve","promise","img","Image","onload","set","delete","emit","loaded","size","total","onerror","src","secondaryFrames","filter","frame","then","remainingFrames","setupScrollListener","calculateProgress","scrollHeight","innerHeight","scrollDistance","scrollY","top","max","min","render","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","removeEventListener","observe","frameIndices","promises","map","index","all","frameIndex","imageUrl","image","drawImage","containerRect","clearRect","containerRatio","imageRatio","drawWidth","drawHeight","x","y","event","data","eventName","customEvent","CustomEvent","detail","dispatchEvent","getLoadingProgress","percentage","destroy","remove","clear"],"mappings":"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"}